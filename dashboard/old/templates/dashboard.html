<!DOCTYPE html>
<html>

<head>
    <title>Weather Dashboard</title>
</head>
    <body>
        <h1>Weather Dashboard</h1>
    
        <h2>Current Conditions</h2>
        <p>Last update: <br><span id="last-update-span">-</span></p>
        <p>Temperature: <br><span id="temperature-span">-</span></p>
        <p>High Temperature: <br><span id="high-temperature-span">-</span><span id="high-temperature-timestamp-span"></span></p>
        <p>Low Temperature: <br><span id="low-temperature-span">-</span><span id="low-temperature-timestamp-span"></span></p>
        <p>Humidity: <br><span id="humidity-span">-</span></p>
    
    </body>
</html>

<link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Inter', sans-serif;
    }

    #temperature-span, #humidity-span, #last-update-span, #high-temperature-span, #low-temperature-span {
        font-size: 2em;
        font-weight: bold;
    }
</style>

<script>
    const temperatureIndicator = document.getElementById("temperature-span");
    const humidityIndicator = document.getElementById("humidity-span");
    const lastUpdateIndicator = document.getElementById("last-update-span");
    const highTempIndicator = document.getElementById("high-temperature-span");
    const highTempTimeIndicator = document.getElementById("high-temperature-timestamp-span");
    const lowTempIndicator = document.getElementById("low-temperature-span");
    const lowTempTimeIndicator = document.getElementById("low-temperature-timestamp-span");

    const updateEventSource = new EventSource("/update-events-sse");

    updateEventSource.onmessage = function(event) {
        const data = JSON.parse(event.data);

        temperatureIndicator.textContent = `${data.temperature.toFixed(1)}°C`;
        humidityIndicator.textContent = `${data.humidity}%`;
        lastUpdateIndicator.textContent = `${data.last_update}`;
        highTempIndicator.textContent = `${data.high_temperature.toFixed(1)}°C`;
        highTempTimeIndicator.textContent = `${data.high_temperature_time}`;
        lowTempIndicator.textContent = `${data.low_temperature.toFixed(1)}°C`;
        lowTempTimeIndicator.textContent = `${data.low_temperature_time}`;
    }

    updateEventSource.onerror = function(err) {
        temperatureIndicator.textContent = '-';
        humidityIndicator.textContent = '-';
        lastUpdateIndicator.textContent = '-';

        console.error("SSE error:", err);
    }
</script>